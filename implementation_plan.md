### 1. ぷよぷよの基本ルール

*   **ぷよの消去:** 同じ色のぷよを4つ以上つなげると消えます。
*   **連鎖:** ぷよが消えた後の空間に上のぷよが落ち、再びぷよが4つ以上つながって消える現象です。
*   **おじゃまぷよ:** 連鎖をすると相手のフィールドに「おじゃまぷよ」を送ることができます。これは隣接するぷよが消えると一緒に消えます。
*   **勝敗:** フィールドの左から3列目が最上段まで埋まると負けとなります。
*   **相殺:** 相手からおじゃまぷよが送られてくる予告がある際に、こちらも連鎖をすることで、送られてくるおじゃまぷよの数を減らしたり、逆に相手に送り返したりできます。
*   **全消し:** フィールド上のぷよを全て消すと、次に相手に送るおじゃまぷよの量が大幅に増加するボーナスが得られます。

### 2. 実装計画

上記のルールを踏まえ、以下のステップで実装を進めます。

#### **フェーズ1: 基本的なゲーム мехаニズムの実装**

1.  **プロジェクト設定:**
    *   `npx create-react-app puyopuyo --template typescript` コマンドでプロジェクトの雛形を作成します。
2.  **コンポーネント設計:**
    *   `Game`: ゲーム全体の状態（フィールド、スコア等）とロジックを管理する親コンポーネント。
    *   `Field`: ゲームの盤面（フィールド）を描画するコンポーネント。
    *   `Puyo`: ぷよ1つ1つを描画するコンポーネント。
3.  **データ構造の型定義 (types.ts):**
    *   ぷよの色や状態を表す型 (`PuyoState`)
    *   フィールド全体の状態を表す型 (`FieldState`: 2次元配列)
    *   ゲーム全体のの状態を表す型 (`GameState`)
4.  **ぷよの描画と落下:**
    *   `Field`コンポーネントが、`GameState`に基づいてぷよを描画します。
    *   `setInterval` を用いたゲームループを実装し、一定時間ごとにぷよを1マスずつ落下させます。
5.  **プレイヤー操作:**
    *   キーボードイベント（左右移動、回転、高速落下）を検知し、落下中のぷよを操作できるようにします。

#### **フェーズ2: コアロジックの実装**

6.  **ぷよの接地と固定:**
    *   ぷよがフィールドの底、または他のぷよの上に到達したことを判定し、フィールドに固定します。
7.  **ぷよの消去判定:**
    *   ぷよが固定された後、同じ色のぷよが4つ以上つながっているかを探索アルゴリズム（幅優先探索など）を用いて判定し、対象のぷよを消去します。
8.  **連鎖と重力処理:**
    *   ぷよが消去された後、宙に浮いたぷよを落下させます。
    *   落下した結果、再びぷよが消える条件を満たした場合、連鎖として処理を繰り返します。連鎖数をカウントし、スコアに反映させます。
9.  **ゲームオーバー判定:**
    *   ぷよがフィールドの指定された領域（左から3列目の最上段）まで積み上がった時点でゲームオーバーとします。

#### **フェーズ3: UIと対戦機能**

10. **UIの整備:**
    *   スコア、連鎖数、次のぷよ（ネクストぷよ）を表示する領域を作成します。
11. **対戦機能（発展）:**
    *   おじゃまぷよのロジックを実装します。
    *   相殺システムのロジックを実装します。
    *   （ネットワーク対戦を視野に入れる場合は、WebSocketなどを用いた通信処理を追加します。）
